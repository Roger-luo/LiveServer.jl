<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>File watching · LiveServer.jl</title><link href="https://cdnjs.cloudflare.com/ajax/libs/normalize/4.2.0/normalize.min.css" rel="stylesheet" type="text/css"/><link href="https://fonts.googleapis.com/css?family=Lato|Roboto+Mono" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.2.0/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link href="../../assets/documenter.css" rel="stylesheet" type="text/css"/></head><body><nav class="toc"><h1>LiveServer.jl</h1><select id="version-selector" onChange="window.location.href=this.value" style="visibility: hidden"></select><form class="search" id="search-form" action="../../search/"><input id="search-query" name="q" type="text" placeholder="Search docs"/></form><ul><li><a class="toctext" href="../../">Home</a></li><li><span class="toctext">Manual</span><ul><li><a class="toctext" href="../server/">Live server</a></li><li class="current"><a class="toctext" href>File watching</a><ul class="internal"><li><a class="toctext" href="#Logic-1">Logic</a></li><li><a class="toctext" href="#Example-1">Example</a></li><li><a class="toctext" href="#Implementing-your-own-file-watcher-1">Implementing your own file watcher</a></li></ul></li></ul></li><li><span class="toctext">Library</span><ul><li><a class="toctext" href="../../lib/public/">Public</a></li><li><a class="toctext" href="../../lib/internals/">Internals</a></li></ul></li></ul></nav><article id="docs"><header><nav><ul><li>Manual</li><li><a href>File watching</a></li></ul><a class="edit-page" href="https://github.com/asprionj/LiveServer.jl/blob/master/docs/src/man/watching.md"><span class="fa"></span> Edit on GitHub</a></nav><hr/><div id="topbar"><span>File watching</span><a class="fa fa-bars" href="#"></a></div></header><h1><a class="nav-anchor" id="File-watching-1" href="#File-watching-1">File watching</a></h1><p>The file watching is considered an &quot;internal&quot; part of <code>LiveServer.jl</code>. Nevertheless, you may use for other tasks than a live server. For this reason, and for the people that want to get to know the structure of <code>LiveServer.jl</code>, the main logic and functions are outlined here. For the details on the internal stuff, have a look at the <a href="../../lib/internals/#Internal-Interface-1">Internal Interface</a>.</p><h2><a class="nav-anchor" id="Logic-1" href="#Logic-1">Logic</a></h2><p>A single file being watched is represented by an object of type <a href="../../lib/internals/#LiveServer.WatchedFile"><code>LiveServer.WatchedFile</code></a>. There are two methods to check whether the file has changed and to set the current state as &quot;unchanged&quot;.</p><p>The watcher itself is defined as the abstract type <a href="../../lib/internals/#LiveServer.FileWatcher"><code>LiveServer.FileWatcher</code></a>. All API functions are implemented for this abstract type. Every file watcher has to be a sub-type of <code>FileWatcher</code> and thus may only change some of the API functions and use the &quot;default&quot; implementation for the others. <code>LiveServer.jl</code>&#39;s default watcher is <a href="../../lib/internals/#LiveServer.SimpleWatcher"><code>LiveServer.SimpleWatcher</code></a>. It just uses all of the default API-function implementations. That is, none of them are specialised for <code>SimpleWatcher</code>, and thus the ones defined for <code>FileWatcher</code> are dispatched.</p><p>The watcher is started using <a href="../../lib/internals/#LiveServer.start"><code>LiveServer.start</code></a>. This command spawns an asynchronous task running in an infinite loop that checks the watched files for changes. Unsurprisingly, <a href="../../lib/internals/#LiveServer.stop"><code>LiveServer.stop</code></a> stops this loop. Now, what&#39;s left to do is to tell the watcher which files should be observed, and what the reaction to a change should be.</p><p>Files to be watched can be added using <a href="../../lib/internals/#LiveServer.watch_file!"><code>LiveServer.watch_file!</code></a>. The watcher checks whether the file is already watched and thus will not add it twice to its list. Also, renamed or deleted files are automatically removed from the list of watched files. You can add files while the watcher is running or stopped.</p><p>Finally, you can pass a callback function to the file watcher, which is fired whenever a file changes. Just pass a function receiving an <code>AbstractString</code> as argument to <a href="../../lib/internals/#LiveServer.set_callback!"><code>LiveServer.set_callback!</code></a>. The string contains the path to the file (including its name and extension). In the context of the live server, this callback function triggers a page reload in the browsers viewing a HTML page.</p><h2><a class="nav-anchor" id="Example-1" href="#Example-1">Example</a></h2><p>This is an example illustrating the API and all features of the default <code>SimpleWatcher</code>.</p><pre><code class="language-julia">using LiveServer: SimpleWatcher, start, stop, set_callback!, watch_file!, verbose
verbose(true) # run in verbose mode to see information about watched files

# create a file, instantiate file watcher, add the file to be watched
write(&quot;textfile.txt&quot;, &quot;A text file.&quot;)
w = SimpleWatcher(f -&gt; println(&quot;File changed: $f&quot;))
watch_file!(w, &quot;textfile.txt&quot;)

# start the watcher, change the file
start(w)
write(&quot;textfile.txt&quot;, &quot;Changed text file.&quot;)
sleep(0.15) # make sure a file-check runs before changing callback

# change the callback function, change the file again, sstop the watcher
set_callback!(w, f -&gt; println(&quot;Changed: $f&quot;))
write(&quot;textfile.txt&quot;, &quot;Second-time changed text file.&quot;)
sleep(0.15)
stop(w)

# watcher does not add files that do not exist
watch_file!(w, &quot;this_file_does_not_exist_at.all&quot;)

# let&#39;s remove the watched file and see if the watcher notices
rm(&quot;textfile.txt&quot;)
start(w)
sleep(0.15)
stop(w)</code></pre><h2><a class="nav-anchor" id="Implementing-your-own-file-watcher-1" href="#Implementing-your-own-file-watcher-1">Implementing your own file watcher</a></h2><p>There may be circumstances where you want the page-reloading to be triggered by your own mechanism. As a very simple example, you may want to display your own custom messages every-time a file is updated.</p><h3><a class="nav-anchor" id="Using-SimpleWatcher-and-a-custom-callback-1" href="#Using-SimpleWatcher-and-a-custom-callback-1">Using SimpleWatcher and a custom callback</a></h3><p>If you want something custom to happen every time a file is modified, you will want to write your own callback function (the function that is called upon changes in a specific file). The base <a href="man/@ref"><code>file_changed_callback</code></a> that is used calls the internal function <a href="man/@ref"><code>update_and_close_viewers!</code></a> which sends a message to the client (browser) telling it to refresh the page. Typically you will want to keep that part but you may want to modify what happens before.</p><p>Once you have defined your own callback function, you can wrap it in a <code>SimpleWatcher</code> which will trigger the function every time one of the watched file gets modified.</p><p>In the example below, we chain the base function with a custom message that gets printed upon every file change.</p><pre><code class="language-julia">custom_callback(fp::AbstractString) = (println(&quot;Hello!&quot;); file_changed_callback(fp))</code></pre><footer><hr/><a class="previous" href="../server/"><span class="direction">Previous</span><span class="title">Live server</span></a><a class="next" href="../../lib/public/"><span class="direction">Next</span><span class="title">Public</span></a></footer></article></body></html>
