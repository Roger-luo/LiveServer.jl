<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Internals · LiveServer.jl</title><link href="https://cdnjs.cloudflare.com/ajax/libs/normalize/4.2.0/normalize.min.css" rel="stylesheet" type="text/css"/><link href="https://fonts.googleapis.com/css?family=Lato|Roboto+Mono" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.2.0/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link href="../../assets/documenter.css" rel="stylesheet" type="text/css"/></head><body><nav class="toc"><h1>LiveServer.jl</h1><select id="version-selector" onChange="window.location.href=this.value" style="visibility: hidden"></select><form class="search" id="search-form" action="../../search/"><input id="search-query" name="q" type="text" placeholder="Search docs"/></form><ul><li><a class="toctext" href="../../">Home</a></li><li><span class="toctext">Manual</span><ul><li><a class="toctext" href="../../man/functionalities/">Functionalities</a></li><li><a class="toctext" href="../../man/extending_ls/">Extending LiveServer</a></li><li><a class="toctext" href="../../man/server/">Live server</a></li><li><a class="toctext" href="../../man/watching/">File watching</a></li></ul></li><li><span class="toctext">Library</span><ul><li><a class="toctext" href="../public/">Public</a></li><li class="current"><a class="toctext" href>Internals</a><ul class="internal"><li><a class="toctext" href="#File-watching-1">File watching</a></li><li><a class="toctext" href="#Live-serving-1">Live serving</a></li><li><a class="toctext" href="#Miscellaneous-1">Miscellaneous</a></li></ul></li></ul></li></ul></nav><article id="docs"><header><nav><ul><li>Library</li><li><a href>Internals</a></li></ul><a class="edit-page" href="https://github.com/asprionj/LiveServer.jl/blob/master/docs/src/lib/internals.md"><span class="fa"></span> Edit on GitHub</a></nav><hr/><div id="topbar"><span>Internals</span><a class="fa fa-bars" href="#"></a></div></header><h1><a class="nav-anchor" id="Internal-Interface-1" href="#Internal-Interface-1">Internal Interface</a></h1><p>Documentation for <code>LiveServer.jl</code>&#39;s internal interface</p><h2><a class="nav-anchor" id="File-watching-1" href="#File-watching-1">File watching</a></h2><p>There are two key types related to file watching:</p><ol><li>one to wrap a file being watched (<a href="#LiveServer.WatchedFile"><code>LiveServer.WatchedFile</code></a>),</li><li>one for the file watcher itself wrapping the list of watched files and what to do upon file changes (&quot;callback&quot; function)</li></ol><p>Any file watcher will be a subtype of the abstract type <a href="#LiveServer.FileWatcher"><code>LiveServer.FileWatcher</code></a> with, for instance, the default watcher being <a href="#LiveServer.SimpleWatcher"><code>LiveServer.SimpleWatcher</code></a>.</p><h3><a class="nav-anchor" id="Watched-file-1" href="#Watched-file-1">Watched file</a></h3><section class="docstring"><div class="docstring-header"><a class="docstring-binding" id="LiveServer.WatchedFile" href="#LiveServer.WatchedFile"><code>LiveServer.WatchedFile</code></a> — <span class="docstring-category">Type</span>.</div><div><div><pre><code class="language-none">WatchedFile</code></pre><p>Struct for a file being watched containing the path to the file as well as the time of last modification.</p></div></div><a class="source-link" target="_blank" href="https://github.com/asprionj/LiveServer.jl/blob/0c13f6a7d9a82861aac2ef72cbd6e5e0e5f0de87/src/file_watching.jl#L1-L6">source</a></section><section class="docstring"><div class="docstring-header"><a class="docstring-binding" id="LiveServer.has_changed" href="#LiveServer.has_changed"><code>LiveServer.has_changed</code></a> — <span class="docstring-category">Function</span>.</div><div><div><pre><code class="language-none">has_changed(wf::WatchedFile)</code></pre><p>Check if a <code>WatchedFile</code> has changed. Returns -1 if the file does not exist, 0 if it does exist but has not changed, and 1 if it has changed.</p></div></div><a class="source-link" target="_blank" href="https://github.com/asprionj/LiveServer.jl/blob/0c13f6a7d9a82861aac2ef72cbd6e5e0e5f0de87/src/file_watching.jl#L20-L25">source</a></section><section class="docstring"><div class="docstring-header"><a class="docstring-binding" id="LiveServer.set_unchanged!" href="#LiveServer.set_unchanged!"><code>LiveServer.set_unchanged!</code></a> — <span class="docstring-category">Function</span>.</div><div><div><pre><code class="language-none">set_unchanged!(wf::WatchedFile)</code></pre><p>Set the current state of a <code>WatchedFile</code> as unchanged&quot;</p></div></div><a class="source-link" target="_blank" href="https://github.com/asprionj/LiveServer.jl/blob/0c13f6a7d9a82861aac2ef72cbd6e5e0e5f0de87/src/file_watching.jl#L31-L35">source</a></section><h3><a class="nav-anchor" id="File-watcher-1" href="#File-watcher-1">File watcher</a></h3><p>Key types</p><section class="docstring"><div class="docstring-header"><a class="docstring-binding" id="LiveServer.FileWatcher" href="#LiveServer.FileWatcher"><code>LiveServer.FileWatcher</code></a> — <span class="docstring-category">Type</span>.</div><div><div><pre><code class="language-none">FileWatcher</code></pre><p>Abstract Type for file watching objects such as <a href="#LiveServer.SimpleWatcher"><code>SimpleWatcher</code></a>.</p></div></div><a class="source-link" target="_blank" href="https://github.com/asprionj/LiveServer.jl/blob/0c13f6a7d9a82861aac2ef72cbd6e5e0e5f0de87/src/file_watching.jl#L39-L43">source</a></section><section class="docstring"><div class="docstring-header"><a class="docstring-binding" id="LiveServer.SimpleWatcher" href="#LiveServer.SimpleWatcher"><code>LiveServer.SimpleWatcher</code></a> — <span class="docstring-category">Type</span>.</div><div><div><pre><code class="language-none">SimpleWatcher([callback]; sleeptime::Float64=0.1) &lt;: FileWatcher</code></pre><p>A simple file watcher. You can specify a callback function, receiving the path of each file that has changed as an <code>AbstractString</code>, at construction or later by the API function described below. The <code>sleeptime</code> is the time waited between two runs of the loop looking for changed files, it is constrained to be at least 0.05s.</p></div></div><a class="source-link" target="_blank" href="https://github.com/asprionj/LiveServer.jl/blob/0c13f6a7d9a82861aac2ef72cbd6e5e0e5f0de87/src/file_watching.jl#L47-L54">source</a></section><p>Functions related to a <code>FileWatcher</code></p><pre><code class="language-none">LiveServer.start
LiveServer.stop
LiveServer.set_callback!
LiveServer.watch_file!
LiveServer.file_watcher_task!</code></pre><p>Additional helper functions:</p><section class="docstring"><div class="docstring-header"><a class="docstring-binding" id="LiveServer.is_running" href="#LiveServer.is_running"><code>LiveServer.is_running</code></a> — <span class="docstring-category">Function</span>.</div><div><div><pre><code class="language-none">is_running(fw::FileWatcher)</code></pre><p>Optional API function to check whether the file watcher is running.</p></div></div><a class="source-link" target="_blank" href="https://github.com/asprionj/LiveServer.jl/blob/0c13f6a7d9a82861aac2ef72cbd6e5e0e5f0de87/src/file_watching.jl#L135-L139">source</a></section><section class="docstring"><div class="docstring-header"><a class="docstring-binding" id="LiveServer.is_watched" href="#LiveServer.is_watched"><code>LiveServer.is_watched</code></a> — <span class="docstring-category">Function</span>.</div><div><div><pre><code class="language-none">is_watched(fw::FileWatcher, f_path::AbstractString)</code></pre><p>Check whether a file <code>f_path</code> is being watched by file watcher <code>fw</code>.</p></div></div><a class="source-link" target="_blank" href="https://github.com/asprionj/LiveServer.jl/blob/0c13f6a7d9a82861aac2ef72cbd6e5e0e5f0de87/src/file_watching.jl#L177-L181">source</a></section><h2><a class="nav-anchor" id="Live-serving-1" href="#Live-serving-1">Live serving</a></h2><p>The exported <a href="../public/#LiveServer.serve"><code>serve</code></a> and <a href="../public/#LiveServer.verbose"><code>verbose</code></a> functions are not stated again. The <code>serve</code> method instantiates a listener (<code>HTTP.listen</code>) in an asynchronous task. The callback upon an incoming HTTP stream decides whether it is a standard HTTP request or a request for an upgrade to a websocket connection. The former case is handled by <a href="#LiveServer.serve_file"><code>LiveServer.serve_file</code></a>, the latter by <a href="#LiveServer.ws_tracker"><code>LiveServer.ws_tracker</code></a>. Finally, <a href="#LiveServer.file_changed_callback"><code>LiveServer.file_changed_callback</code></a> is the function passed to the file watcher to be executed upon file changes.</p><section class="docstring"><div class="docstring-header"><a class="docstring-binding" id="LiveServer.serve_file" href="#LiveServer.serve_file"><code>LiveServer.serve_file</code></a> — <span class="docstring-category">Function</span>.</div><div><div><pre><code class="language-none">serve_file(fw, req::HTTP.Request)</code></pre><p>Handler function for serving files. This takes a file watcher, to which files to be watched can be added, and a request (e.g. a path entered in a tab of the browser), and converts it to the appropriate file system path. If the path corresponds to a HTML file, it will inject the reloading script (see file <code>client.js</code>) at the end of its body, i.e. directly before the &lt;/body&gt; tag. All files served are added to the file watcher, which is responsible to check whether they&#39;re already watched or not. Finally the file is served via a 200 (successful) response. If the file does not exist, a response with status 404 and message &quot;404 not found&quot; is sent.</p></div></div><a class="source-link" target="_blank" href="https://github.com/asprionj/LiveServer.jl/blob/0c13f6a7d9a82861aac2ef72cbd6e5e0e5f0de87/src/server.jl#L60-L72">source</a></section><section class="docstring"><div class="docstring-header"><a class="docstring-binding" id="LiveServer.ws_tracker" href="#LiveServer.ws_tracker"><code>LiveServer.ws_tracker</code></a> — <span class="docstring-category">Function</span>.</div><div><div><pre><code class="language-none">ws_tracker(ws::HTTP.WebSockets.WebSocket, target::AbstractString)</code></pre><p>Adds the websocket connection to the viewers in the global dictionary <code>WS_VIEWERS</code> to the entry corresponding to the targeted file.</p></div></div><a class="source-link" target="_blank" href="https://github.com/asprionj/LiveServer.jl/blob/0c13f6a7d9a82861aac2ef72cbd6e5e0e5f0de87/src/server.jl#L120-L125">source</a></section><section class="docstring"><div class="docstring-header"><a class="docstring-binding" id="LiveServer.file_changed_callback" href="#LiveServer.file_changed_callback"><code>LiveServer.file_changed_callback</code></a> — <span class="docstring-category">Function</span>.</div><div><div><pre><code class="language-none">file_changed_callback(f_path::AbstractString)</code></pre><p>Function reacting to the change of a file <code>f_path</code>. Is set as callback for the file watcher.</p></div></div><a class="source-link" target="_blank" href="https://github.com/asprionj/LiveServer.jl/blob/0c13f6a7d9a82861aac2ef72cbd6e5e0e5f0de87/src/server.jl#L22-L26">source</a></section><p>Additional helper functions:</p><section class="docstring"><div class="docstring-header"><a class="docstring-binding" id="LiveServer.get_fs_path" href="#LiveServer.get_fs_path"><code>LiveServer.get_fs_path</code></a> — <span class="docstring-category">Function</span>.</div><div><div><pre><code class="language-none">get_fs_path(req_path::AbstractString)</code></pre><p>Return the filesystem path corresponding to a requested path, or an empty String if the file was not found.</p></div></div><a class="source-link" target="_blank" href="https://github.com/asprionj/LiveServer.jl/blob/0c13f6a7d9a82861aac2ef72cbd6e5e0e5f0de87/src/server.jl#L40-L45">source</a></section><section class="docstring"><div class="docstring-header"><a class="docstring-binding" id="LiveServer.update_and_close_viewers!" href="#LiveServer.update_and_close_viewers!"><code>LiveServer.update_and_close_viewers!</code></a> — <span class="docstring-category">Function</span>.</div><div><div><pre><code class="language-none">update_and_close_viewers!(wss::Vector{HTTP.WebSockets.WebSocket})</code></pre><p>Take a list of viewers, i.e. WebSocket connections from a client, send a message with data &quot;update&quot; to each of them (to trigger a page reload), then close the connection. Finally, empty the list since all connections are closing anyway and clients will re-connect from the re-loaded page.</p></div></div><a class="source-link" target="_blank" href="https://github.com/asprionj/LiveServer.jl/blob/0c13f6a7d9a82861aac2ef72cbd6e5e0e5f0de87/src/server.jl#L1-L8">source</a></section><h2><a class="nav-anchor" id="Miscellaneous-1" href="#Miscellaneous-1">Miscellaneous</a></h2><section class="docstring"><div class="docstring-header"><a class="docstring-binding" id="LiveServer.example" href="#LiveServer.example"><code>LiveServer.example</code></a> — <span class="docstring-category">Function</span>.</div><div><div><pre><code class="language-none">example()</code></pre><p>Simple function to copy an example website folder to the current working directory that can be watched by the LiveServer to get an idea of how things work.</p><p><strong>Example</strong></p><pre><code class="language-julia">LiveServer.example()
cd(&quot;example&quot;)
serve()</code></pre></div></div><a class="source-link" target="_blank" href="https://github.com/asprionj/LiveServer.jl/blob/0c13f6a7d9a82861aac2ef72cbd6e5e0e5f0de87/src/LiveServer.jl#L45-L58">source</a></section><footer><hr/><a class="previous" href="../public/"><span class="direction">Previous</span><span class="title">Public</span></a></footer></article></body></html>
